# Перехват системных событий
### Лабораторная работа #4
[[презентация]](https://www.dropbox.com/s/c8297ep7h5u60sl/Task%204.pptx?dl=0) [[репозиторий]](https://github.com/Andrew414/syseventstask)

## Условие
Необходимо написать приложение (скрипт/сервис/модуль ядра), осуществляющее слежение за исполняемыми процессами. Приложение должно иметь конфигурационный файл, читаемый им при запуске, в котором перечислены имена (пути) к исполняемым файлам. Все эти исполняемые файлы считаются запрещенными, т.е. фактически конфигурационный файл являетс "черным списком" процессов.

Как только запускается запрещенный процесс, приложение должно его завершить. Поскольку запрещенные процессы могут работать с правами администратора, необходимо, чтобы приложение само запрашивало права администратора при запуске. В случае Win32-приложений это удобно сделать через manifest-файл, встраиваемый в приложение (https://msdn.microsoft.com/en-us/library/bb384691.aspx, https://stackoverflow.com/questions/2818179/how-do-i-force-my-net-application-to-run-as-administrator). В случае других ОС или реализации приложения как скрипта оно должно на старте проверять, запущено ли с правами администратора, и если нет, то перезапускать себя же с правами администратора.

Приложение должно вести свой лог и записывать туда время создания всех процессов в системе, а также, если был найден запрещенный процесс, логгировать попытку его завершения.

#### Пример конфигурационного файла
```
{
    "blacklistedapps" : [ 
        "C:\\Windows\\System32\\calc.exe", 
        "C:\\Windows\\System32\\notepad.exe", 
        "C:\\Windows\\System32\\mspaint.exe" 
    ]
}
```

#### Пример журнала (лога)
```
2018-03-27 12:10:56 C:\Program Files\Google\Chrome\Application\chrome.exe [pid 8592]
2018-03-27 12:11:02 C:\Windows\System32\explorer.exe [pid 2974]
2018-03-27 12:11:04 C:\Program Files\Internet Explorer\iexplore.exe [pid 9787]
2018-03-27 12:12:12 C:\Windows\System32\notepad.exe [pid 2760]
2018-03-27 12:12:13 [BANNED APP] - C:\Windows\System32\notepad.exe [pid 2760] - killing...
2018-03-27 12:12:13 [BANNED APP] - pid 2760 wasn't killed - error '5' (ERROR_ACCESS_DENIED)
2018-03-27 12:12:23 C:\Program Files\Google\Chrome\Application\chrome.exe [pid 964]
2018-03-27 12:13:00 C:\Windows\System32\calc.exe [pid 7789]
2018-03-27 12:13:01 [BANNED APP] - C:\Windows\System32\calc.exe [pid 7789] - killing...
2018-03-27 12:13:01 [BANNED APP] - successfully killed pid 7789 - error '0' (ERROR_SUCCESS)
```

### Дополнительные требования
Программа должна быть написана с использованием общепринятого [**стандарта**](https://ru.wikipedia.org/wiki/Стандарт_оформления_кода). Если для выбранного языка есть один такой стандарт, используйте его, иначе выберите любой для своего языка программирования и укажите в комментариях к Pull Request, какой именно стандарт выбран.

### Дополнительные задания
Три задачи:
* Запрет открытия файлов
  * Вместо списка запрещенных приложений вводится список запрещенных файлов. 
  * Как только любой процесс открывает запрещенный файл, он должен быть завершен.
  * Можно сделать комбинированный запрет - например, запретить `notepad.exe` открытие файла `C:\Users\User\Desktop\eicar.com`
  * При этом блокнот должен быть способен открывать другие файлы, и другими программами должно быть можно открыть файл `eicar.com`
  * Все конфигурации (приложений и путей) должны быть в одном файле
* Конфигурация запрещенных приложений по их md5-хешу
  * Поскольку пути к одному приложению могут быть разными на разных компьютерах, то целесообразнее проверять приложения по их хешу.
  * Вместо хеша может быть другая проверка - проверка цифровой подписи, проверка дополнительных параметров файла - даты, времени, версии и тд. 
  * Пример разных путей к одному приложению - `C:\Program Files\Office14\winword.exe` или `C:\Program Files (x86)\Office14\winword.exe` 
  * Пример разных путей к одному приложению - `C:\Program Files\Ubisoft\ACOrigins\game.exe` или `D:\Games\ACOrigins\game.exe`
* Графический интерфейс для главного приложения
  * Графический интерфейс должен отображать список запрещенных приложений и позволять его модифицировать
  * Графический интерфейс должен показывать журнал
  * Графический интерфейс должен запрашивать права администратора один раз при запуске (не при каждой попытке завершить запрещенный процесс)



### Репозиторий
[Репозиторий](https://github.com/Andrew414/syseventstask) содержит главную страницу [`README.md`](https://github.com/Andrew414/syseventstask/blob/master/README.md) и одиннадцать персональных каталогов. Необходимо сделать копию (fork) репозитория и вносить все изменения только в свой персональный каталог. Все эти каталоги содержат пустой файл `.gitignore`, куда нужно вписать все временные файлы из лабораторной работы. Остальные файлы должны быть файлами кода (в т.ч. проекта).

### Сдача лабораторной работы
Можно выбрать любой язык программирования, IDE и фреймворки/библиотеки. Если для работы нужны какие-то нестандартные конфигурации или ПО, предоставьте инструкцию по настройке среды.

Сдача через **Pull Request** из вашего клонированного репозитория. Pull Request должен содержать код, файлы проекта и информационные файлы. Результаты сборок и временные файлы должны быть исключены из коммитов.

### Оценка
Максимум за лабораторную работу - **10 баллов**.
- **3 балла** за главную задачу
- **3 балла**, если работа сделана вовремя
- **2 балла** за слежение за открытыми *файлами* вместо процессов
- **1 балл** за проверку процессов по *дополнительным признакам* - хеш, цифровая подпись, версия файла
- **1 балл** за реализацию *графического интерфейса*

### Сроки
На выполнение лабораторной дается 4 недели (29 марта - 26 апреля). Лабораторная работа считается принятой, когда Pull Request переходит в состояние "approved". Дни, в течение которых лабораторная была на проверке, не учитываются.
![ ](https://i.snag.gy/lPOzf7.jpg)

Например, если вы сдаете лабораторную через две недели после выдачи (12 апреля), но комментарии даны только через неделю (19 апреля), у вас все еще будет две недели на устранение недочетов, все дни после коммита до получения ревью не считаются.

### Желаю удачи!
